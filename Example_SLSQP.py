from scipy.optimize import minimize
import numpy as np

E0 = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 135.93520968143184, 203.90281452214782, 271.8704193628637, 424.7975302544746, 577.7246411460854, 730.6517520376964, 883.5788629293072, 866.5869617191278, 849.5950605089494, 832.6031592987699, 815.6112580885913, 815.6112580885913, 815.6112580885913, 815.6112580885913, 815.6112580885913, 917.5626653496648, 1019.514072610739, 1121.465479871813, 1223.4168871328868, 1240.4087883430657, 1257.400689553245, 1274.3925907634236, 1291.3844919736027, 1206.4249859227077, 1121.465479871813, 1036.5059738209181, 951.5464677700232, 815.6112580885913, 679.6760484071592, 543.7408387257274, 407.80562904429564, 305.8542217832217, 203.90281452214782, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
E1 = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.095541959394951, 3.095541959394951, 3.095541959394951, 13.12973913827916, 13.12973913827916, 13.12973913827916, 13.12973913827916, 10.554775902905341, 10.554775902905341, 10.554775902905341, 10.554775902905341, 0.0, 0.0, 0.0, 0.0, 0.0, 16.149332376345804, 16.149332376345804, 16.149332376345804, 16.149332376345804, 42.31217083831925, 42.31217083831925, 42.31217083831925, 19.66200973015714, 19.66200973015714, 19.66200973015714, 19.66200973015714, 27.52091396934956, 27.52091396934956, 27.52091396934956, 27.52091396934956, 329.2237299969277, 329.2237299969277, 329.2237299969277, 329.2237299969277, 577.9124838502333, 577.9124838502333, 577.9124838502333, 577.9124838502333, 577.9124838502333, 573.0452854570782, 573.0452854570782, 573.0452854570782, 573.0452854570782, 370.91790620023994, 370.91790620023994, 370.91790620023994, 370.91790620023994, 329.2237299969277, 329.2237299969277, 329.2237299969277, 290.5411117368605, 290.5411117368605, 290.5411117368605, 290.5411117368605, 163.41893588842228, 163.41893588842228, 163.41893588842228, 163.41893588842228, 115.3233378968986, 115.3233378968986, 115.3233378968986, 115.3233378968986, 206.25698899144692, 206.25698899144692, 206.25698899144692, 206.25698899144692, 309.48366575039114, 309.48366575039114, 309.48366575039114, 309.48366575039114, 644.4723765004536, 644.4723765004536, 644.4723765004536, 644.4723765004536, 581.4832995209256, 581.4832995209256, 581.4832995209256, 581.4832995209256, 581.4832995209256, 618.3483641692815, 618.3483641692815, 618.3483641692815, 618.3483641692815, 587.1387035345958, 587.1387035345958, 587.1387035345958, 587.1387035345958, 592.9400328151568, 592.9400328151568, 592.9400328151568, 592.9400328151568]
E2 = [311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 311.451553946575, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
C = [-238.09793269388078, -231.98014945556884, -226.4038621346316, -221.67417756776217, -217.37730914414377, -213.3855475572187, -209.20793087018725, -204.65754678669694, -199.45910140420102, -193.97817318468344, -188.8894647725575, -185.2516524889065, -183.01356803540787, -181.95404595732737, -181.0848192035878, -179.78298774584653, -177.45038994792517, -175.08649914111214, -174.27266947068077, -176.0967558741133, -181.8608012484003, -189.52420539885912, -197.23962360463787, -202.906618363511, -205.1364566862883, -204.78123874751853, -203.7576613418135, -203.5832239611677, -205.9173018338339, -210.37021242341194, -211.4661020523664, -210.74636284785922, -220.03340899344477, -230.65484824115885, -241.94126392781988, -253.96729410841942, -266.31788353664484, -278.5346319200839, -290.0967643877901, -300.0375806921114, -308.34968045932357, -315.37813254423145, -321.5039504740156, -327.74902014038673, -334.4328262489882, -340.9470580796771, -346.59354323137114, -350.60962033196205, -352.39903069851476, -352.12056520722916, -349.403570854139, -344.65612539033117, -337.9934632066564, -329.52003529225306, -319.7257463876742, -308.9497450487453, -297.5394259620134, -286.3540782365023, -276.09420010503595, -267.58736478924817, -261.4672557191943, -257.1046296890537, -253.93853837051893, -251.06825056170987, -248.25991445293613, -246.2814773975382, -246.5599428888238, -250.58828346587217, -268.0030543533085, -285.1632523846266, -298.5845701711438, -311.97797797675736, -323.9109748876792, -334.81870287890183, -345.0030971983795, -355.14414647175744, -365.1991399706833, -373.6300685959841, -378.0062267380778, -375.8201563398988, -366.0300962203055, -351.06738630662676, -334.40681922132825, -319.42740560695745, -308.79962318176524, -301.6618570049859, -296.259584186196, -290.8943132360278, -284.2794363226875, -276.3143083635236, -267.24271881294186, -257.4477955906152, -247.21921046804047, -237.3232192845639, -228.54743324370762, -221.52278706528654, -238.20280656151755, -232.0850233232057, -226.4825175353592, -221.75283296848977]
P = [229.89065105694536, 229.89065105694536, 229.89065105694536, 229.89065105694536, 223.5974864170219, 223.5974864170219, 223.5974864170219, 223.5974864170219, 222.65129813706153, 222.65129813706153, 222.65129813706153, 222.65129813706153, 218.6168610254046, 218.6168610254046, 218.6168610254046, 218.6168610254046, 216.04875946585696, 216.04875946585696, 216.04875946585696, 216.04875946585696, 211.96472088144813, 211.96472088144813, 211.96472088144813, 211.96472088144813, 209.37181070216718, 209.37181070216718, 209.37181070216718, 209.37181070216718, 205.23837296306382, 205.23837296306382, 205.23837296306382, 205.23837296306382, 210.1355967615753, 210.1355967615753, 210.1355967615753, 210.1355967615753, 202.23145930691305, 202.23145930691305, 202.23145930691305, 202.23145930691305, 192.61562326955348, 192.61562326955348, 192.61562326955348, 192.61562326955348, 190.99145786088897, 190.99145786088897, 190.99145786088897, 190.99145786088897, 188.805123678349, 188.805123678349, 188.805123678349, 188.805123678349, 187.17321783204582, 187.17321783204582, 187.17321783204582, 187.17321783204582, 189.67465833392575, 189.67465833392575, 189.67465833392575, 189.67465833392575, 189.31792642901829, 189.31792642901829, 189.31792642901829, 189.31792642901829, 191.13084632879534, 191.13084632879534, 191.13084632879534, 191.13084632879534, 188.9656881806189, 188.9656881806189, 188.9656881806189, 188.9656881806189, 189.84290021396143, 189.84290021396143, 189.84290021396143, 189.84290021396143, 186.01353682427288, 186.01353682427288, 186.01353682427288, 186.01353682427288, 186.97045119661692, 186.97045119661692, 186.97045119661692, 186.97045119661692, 192.2104050349677, 192.2104050349677, 192.2104050349677, 192.2104050349677, 193.77823259796187, 193.77823259796187, 193.77823259796187, 193.77823259796187, 210.1315243148335, 210.1315243148335, 210.1315243148335, 210.1315243148335, 209.743383420093, 209.743383420093, 209.743383420093, 209.743383420093]


def cost_function(x0):
    value_to_minimize = 0.0
    for i in range(0, len(E0)):
        C_ges = -C[i]
        E_ges = x0[0] * E0[i] + x0[1] * E1[i] + x0[2] * E2[i]
        v = 0.01 * (x0[0] * E0[i]) + 0.12 * (x0[1] * E1[i]) + 0.35 * (x0[2] * E2[i])
        if C_ges > E_ges:
            value_to_minimize += (E_ges * P[i]) - v
        else:
            value_to_minimize += (C_ges * P[i]) - (v * (C_ges / (E_ges)))
    return -value_to_minimize

if __name__ == '__main__':
  x0 = np.array([0, 0, 0])

  minx0 = np.repeat(0.0, [len(x0)] , axis = 0)
  maxx0 = np.repeat(1.0, [len(x0)] , axis = 0)
  bounds = tuple(zip(minx0, maxx0))
 
  def apply_sum_constraint(inputs):
    total = 1.0 - np.sum(inputs)
    return total

  cons = {'type':'eq', 'fun':apply_sum_constraint}
  res_cons = minimize(cost_function, x0, bounds = bounds, constraints=cons, options={'disp': True}, method='SLSQP')

  print(res_cons)
  print('Current value of objective function: ' + str(res_cons['fun']))
  print('Current value of controls:')
  print(res_cons['x'])